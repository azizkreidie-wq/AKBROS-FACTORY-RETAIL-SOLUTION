{% extends "base.html" %}
{% block content %}

{% if not inv %}
  <h2>Create Invoice</h2>
  <form method="post" action="{{ url_for('invoices.create_invoice') }}" class="card">
    <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:10px;">
      <div><label>Customer Name</label><input name="customer_name"></div>
      <div><label>Customer Phone</label><input name="customer_phone"></div>
      <div style="grid-column:1/-1"><label>Notes</label><input name="notes"></div>
    </div>
    <div class="actions" style="margin-top:10px">
      <button class="icon-btn" type="submit" title="Create">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
          <path d="M12 5v14M5 12h14"></path>
        </svg>
      </button>
    </div>
  </form>
{% else %}
  <h2>Invoice #{{ inv.id }}</h2>

  <!-- Header info -->
  <form method="post" class="card">
    <input type="hidden" name="action" value="update-header">
    <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:10px;">
      <div><label>Customer Name</label><input name="customer_name" value="{{ inv.customer_name or '' }}"></div>
      <div><label>Customer Phone</label><input name="customer_phone" value="{{ inv.customer_phone or '' }}"></div>
      <div style="grid-column:1/-1"><label>Notes</label><input name="notes" value="{{ inv.notes or '' }}"></div>
    </div>
    <div class="actions" style="margin-top:10px">
      <button class="icon-btn" type="submit" title="Save">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
          <path d="M5 12h14"></path>
        </svg>
      </button>
    </div>
  </form>

  <!-- Add item -->
  <form method="post" class="card">
    <input type="hidden" name="action" value="add-item">
    <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); gap:10px">
      <div>
        <label>Type</label>
        <select name="item_type">
          <option value="CUSTOM">Custom</option>
          <option value="LOCAL_CUSTOM">Local Custom</option>
          <option value="READY">Ready</option>
        </select>
      </div>
      <div>
        <label>Category</label>
        <select name="category">
          <option value="ABAYA">ABAYA</option>
          <option value="SHEILA">SHEILA</option>
        </select>
      </div>
      <div><label>Model</label><input name="model_number"></div>
      <div><label>Color</label><input name="color"></div>
      <div><label>Qty</label><input name="qty" value="1"></div>
      <div><label>Unit Price</label><input name="unit_price" value="0"></div>

      <div>
        <label>Discount Type</label>
        <select name="discount_type">
          <option value="NONE">None</option>
          <option value="AMOUNT">Amount</option>
          <option value="PERCENT">Percent</option>
        </select>
      </div>
      <div><label>Discount Value</label><input name="discount_value" value="0"></div>
      <div><label>Tax %</label><input name="tax_rate" value="0"></div>

      <div style="grid-column:1/-1"><label>Extra Note</label><input name="extra_note"></div>
    </div>
    <div class="actions" style="margin-top:10px">
      <button class="icon-btn" type="submit" title="Add Item">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
          <circle cx="12" cy="12" r="9"></circle>
          <path d="M12 8v8M8 12h8"></path>
        </svg>
      </button>
    </div>
  </form>

  <!-- Items table -->
  <table class="table">
    <tr>
      <th>#</th><th>Type</th><th>Category</th><th>Model</th><th>Color</th>
      <th>Qty</th><th>Unit</th><th>Disc</th><th>Tax%</th><th>Total</th><th>Actions</th>
    </tr>
    {% for it in items %}
    <tr>
      <td>{{ loop.index }}</td>
      <td>{{ it.item_type }}</td>
      <td>{{ it.category }}</td>
      <td>{{ it.model_number or '' }}</td>
      <td>{{ it.color or '' }}</td>
      <td>{{ it.qty }}</td>
      <td>{{ "%.2f"|format(it.unit_price or 0) }}</td>
      <td>{{ (it.discount_type or 'NONE') ~ ' ' ~ (it.discount_value or 0) }}</td>
      <td>{{ it.tax_rate or 0 }}</td>
      <td>{{ "%.2f"|format(it.line_total or 0) }}</td>
      <td>
        <form method="post" style="display:inline">
          <input type="hidden" name="action" value="delete-item">
          <input type="hidden" name="item_id" value="{{ it.id }}">
          <button class="icon-btn" onclick="return confirm('Delete this item?')" title="Delete">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
              <path d="M3 6h18"></path>
              <path d="M8 6v-2h8v2"></path>
              <rect x="6" y="6" width="12" height="14" rx="1"></rect>
            </svg>
          </button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </table>
{% endif %}

{% endblock %}
