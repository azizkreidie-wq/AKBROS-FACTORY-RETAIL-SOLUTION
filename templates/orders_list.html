{% extends "base.html" %}
{% block body %}
<h2>Orders</h2>

<form method="post" class="card">
  <div class="flex">
    <div style="min-width:220px">
      <label>Order No (required)</label>
      <input name="order_no" placeholder="e.g., AB-500/2025" required>
    </div>
    {% if not is_retail() %}
    <div style="min-width:180px">
      <label>Branch</label>
      <input name="branch" placeholder="e.g., Jeddah">
    </div>
    <div style="min-width:160px">
      <label>Status</label>
      <select name="status">
        {% for s in statuses %}<option value="{{ s }}">{{ s }}</option>{% endfor %}
      </select>
    </div>
    {% endif %}
  </div>
  <div style="margin-top:10px">
    <button class="icon-btn" title="Create Order">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="9"></circle>
        <path d="M12 8v8M8 12h8"></path>
      </svg>
    </button>
  </div>
</form>

<table class="table">
  <tr><th>ID</th><th>Order No</th><th>Branch</th><th>Date</th><th>Status</th><th>Items</th><th>Actions</th></tr>
  {% for r in rows %}
  <tr>
    <td>{{ r.id }}</td>
    <td>{{ r.order_no }}</td>
    <td>{{ r.branch }}</td>
    <td>{{ r.order_date }}</td>
    <td>{{ r.status }}</td>
    <td>{{ counts.get(r.id, 0) }}</td>
    <td>
      <a class="icon-btn" href="/orders/{{ r.id }}" title="Open">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round">
          <path d="M8 12h8M12 8v8"/><rect x="3" y="3" width="18" height="18" rx="2"/>
        </svg>
      </a>
      {% if not (is_retail() and r.status != 'DRAFT') %}
      <form method="post" action="/orders/{{ r.id }}" style="display:inline">
        <input type="hidden" name="action" value="delete-order">
        <button class="icon-btn" title="Delete" onclick="return confirm('Delete this order?')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 6h18"/><path d="M8 6v-2h8v2"/><rect x="6" y="6" width="12" height="14" rx="1"/>
          </svg>
        </button>
      </form>
      {% endif %}
    </td>
  </tr>
  {% endfor %}
</table>
{% endblock %}
